<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Python Code Runner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .code-editor {
            width: 100%;
            height: 300px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #2d2d2d;
            color: #f8f8f2;
            resize: vertical;
        }
        .run-button {
            background-color: #28a745;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
            font-weight: bold;
        }
        .run-button:hover {
            background-color: #218838;
        }
        .run-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .output-container {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            min-height: 100px;
        }
        .output {
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            color: #333;
            font-size: 14px;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        .success {
            color: #28a745;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.connected {
            background-color: #d4edda;
            color: #155724;
        }
        .status.disconnected {
            background-color: #f8d7da;
            color: #721c24;
        }
        .examples {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .example-btn {
            background-color: #007bff;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .example-btn:hover {
            background-color: #0056b3;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        h2 {
            color: #555;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }
    </style>
</head>
<body>
    <h1>üêç Simple Python Code Runner</h1>
    <p style="text-align: center; color: #666;">Write Python code and see the output instantly - no test cases, no complexity!</p>
    
    <div class="container">
        <h2>üîê Connection Status</h2>
        <div id="authStatus" class="status disconnected">Connecting...</div>
    </div>

    <div class="container">
        <h2>üíª Python Code Editor</h2>
        <textarea id="codeEditor" class="code-editor" placeholder="Write your Python code here...">print("Hello, World!")
print("Python is working!")
print(f"2 + 3 = {2 + 3}")

# Try some loops
for i in range(3):
    print(f"Loop iteration: {i}")

# Try some math
import math
print(f"Square root of 16: {math.sqrt(16)}")
</textarea>
        
        <div class="examples">
            <button class="example-btn" onclick="loadExample('hello')">Hello World</button>
            <button class="example-btn" onclick="loadExample('math')">Math Operations</button>
            <button class="example-btn" onclick="loadExample('loops')">Loops & Lists</button>
            <button class="example-btn" onclick="loadExample('functions')">Functions</button>
        </div>
        
        <button class="run-button" onclick="runCode()" id="runButton">
            ‚ñ∂Ô∏è Run Python Code
        </button>
    </div>

    <div class="container">
        <h2>üìä Output</h2>
        <div class="output-container">
            <div id="output" class="output">Click "Run Python Code" to see the output...</div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8001/api';
        let authToken = null;

        // Code examples
        const examples = {
            hello: `print("Hello, World!")
print("Welcome to Python!")
print("This is a simple code runner.")`,
            
            math: `# Math operations
a = 10
b = 5
print(f"{a} + {b} = {a + b}")
print(f"{a} - {b} = {a - b}")
print(f"{a} * {b} = {a * b}")
print(f"{a} / {b} = {a / b}")

import math
print(f"Square root of 25: {math.sqrt(25)}")
print(f"Pi: {math.pi}")`,
            
            loops: `# Loops and lists
numbers = [1, 2, 3, 4, 5]
print("Original list:", numbers)

# For loop
print("\\nSquares:")
for num in numbers:
    print(f"{num}¬≤ = {num**2}")

# List comprehension
squares = [x**2 for x in numbers]
print("\\nSquares list:", squares)

# While loop
count = 0
print("\\nCountdown:")
while count < 5:
    print(f"Count: {count}")
    count += 1`,
            
            functions: `# Functions
def greet(name):
    return f"Hello, {name}!"

def calculate_area(radius):
    import math
    return math.pi * radius ** 2

# Test functions
print(greet("Python"))
print(greet("World"))

radius = 5
area = calculate_area(radius)
print(f"\\nArea of circle with radius {radius}: {area:.2f}")

# Lambda function
square = lambda x: x ** 2
print(f"\\nSquare of 7: {square(7)}")`
        };

        async function login() {
            try {
                const response = await fetch(`${API_BASE}/auth/simple-login/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'testuser', password: 'testpass123' })
                });

                const data = await response.json();
                if (data.success) {
                    authToken = data.tokens.access;
                    document.getElementById('authStatus').textContent = `‚úÖ Connected as ${data.user.username}`;
                    document.getElementById('authStatus').className = 'status connected';
                    return true;
                } else {
                    document.getElementById('authStatus').textContent = '‚ùå Login failed';
                    document.getElementById('authStatus').className = 'status disconnected';
                    return false;
                }
            } catch (error) {
                document.getElementById('authStatus').textContent = `‚ùå Connection error: ${error.message}`;
                document.getElementById('authStatus').className = 'status disconnected';
                return false;
            }
        }

        async function runCode() {
            if (!authToken) {
                const loginSuccess = await login();
                if (!loginSuccess) {
                    alert('Please check your connection and try again.');
                    return;
                }
            }

            const code = document.getElementById('codeEditor').value;
            const runButton = document.getElementById('runButton');
            const output = document.getElementById('output');

            if (!code.trim()) {
                alert('Please enter some Python code!');
                return;
            }

            runButton.disabled = true;
            runButton.textContent = '‚è≥ Running...';
            output.textContent = 'Executing Python code...';
            output.className = 'output';

            try {
                const response = await fetch(`${API_BASE}/submissions/simple-run/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        code: code,
                        language: 'python'
                    })
                });

                const result = await response.json();

                if (result.success) {
                    if (result.error) {
                        output.textContent = `‚ùå Error:\\n${result.error}`;
                        output.className = 'output error';
                    } else {
                        output.textContent = result.output || '(no output)';
                        output.className = 'output success';
                    }
                } else {
                    output.textContent = `‚ùå Failed to run code: ${result.message || 'Unknown error'}`;
                    output.className = 'output error';
                }
            } catch (error) {
                output.textContent = `‚ùå Network Error: ${error.message}`;
                output.className = 'output error';
            } finally {
                runButton.disabled = false;
                runButton.textContent = '‚ñ∂Ô∏è Run Python Code';
            }
        }

        function loadExample(type) {
            document.getElementById('codeEditor').value = examples[type];
        }

        // Auto-login on page load
        window.onload = function() {
            login();
        };

        // Allow Ctrl+Enter to run code
        document.getElementById('codeEditor').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                runCode();
            }
        });
    </script>
</body>
</html>